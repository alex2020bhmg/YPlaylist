/*! YPlaylist 2013-08-04 */
var YPlaylist={init:function(a){this.protocol="auto"===a.secure?"https:"===window.location.protocol?"https://":"http://":a.secure?"https://":"http://",this.url=this.protocol+"gdata.youtube.com/feeds/api/playlists/"+a.playlist+"?v=2&max-results=50&alt=json&callback=?",this.container=a.container,this.secure=a.secure,this.shuffle=a.shuffle,this.fetch()},fetch:function(){var a=this,b=$('<div class="placeholder"></div>'),c=$('<div class="carousel-container"><span class="prev controll"></span><div class="carousel-inner"><ul class="slider"></ul></div><span class="next controll"></span></div>');$.getJSON(a.url,function(d){var e="",f=d.feed,g=f.entry||[];a.shuffle&&g.sort(function(){return.5-Math.random()});for(var h=0;h<g.length;h++){var i=g[h],j=i.title.$t,k=i.link[0].href,l=i.media$group.media$thumbnail[1].url,m=i.media$group.media$description.$t;0==h&&($(a.container).append(b),$(b).html(function(){var b=a.getId(k);return'<iframe width="820" height="380" src="'+a.protocol+"www.youtube.com/embed/"+b+'" frameborder="0" allowfullscreen></iframe><h2>'+j+"</h2>"})),e+='<li><a href="'+k+'" title="'+j+'"><img alt="'+j+'" src="'+l+'">',e+='<span class="shadow"></span></a>',e+="<h2>"+j+"</h2>",e+='<span class="spacer"></span>',e+="<p>"+a.truncate(m,90),e+="</li>"}$(a.container).append(c),$(e).appendTo(".slider"),$(".slider").find("li:first").addClass("current"),a.carousel(),a.view($(".slider li"))})},truncate:function(a,b){if(a.length>b){for(b--,last=a.substr(b-1,1);" "!=last&&b>0;)b--,last=a.substr(b-1,1);last=a.substr(b-2,1),a=","==last||";"==last||":"==last?a.substr(0,b-2)+"...":"."==last||"?"==last||"!"==last?a.substr(0,b-1):a.substr(0,b-1)+"..."}return a},getId:function(a){var b=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/,c=a.match(b);if(c&&11==c[2].length)return c[2];throw new Error("Invalid video URL")},view:function(a){var b=this;a.click(function(a){a.preventDefault();var c=$(this).find("a").attr("href"),d=$(this).find("h2").text();$(this).hasClass("current")||($(".slider li").removeClass("current"),$(this).addClass("current"),$(".placeholder iframe").attr({src:b.protocol+"www.youtube.com/embed/"+b.getId(c)+"?autoplay=1"}),$(".placeholder h2").html(d),$("html, body").animate({scrollTop:$(".placeholder").offset().top},1e3))})},carousel:function(){var a=$(".slider"),b=$(".slider li").outerWidth(!0);$(".slider li:first").before($(".slider li:last")),$(document.body).on("click",".carousel-container .controll",function(){if($(this).hasClass("next")){var c=parseInt(a.css("left"))-b;$(".slider:not(:animated)").animate({left:c},500,function(){$(".slider li:last").after($(".slider li:first")),$(".slider").css({left:"-"+b+"px"})})}else{var c=parseInt(a.css("left"))+b;$(".slider:not(:animated)").animate({left:c},500,function(){$(".slider li:first").before($(".slider li:last")),$(".slider").css({left:"-"+b+"px"})})}})}};